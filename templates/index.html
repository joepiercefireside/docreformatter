<!DOCTYPE html>
{% extends "base.html" %}
{% block title %}Document Reformatter{% endblock %}
{% block content %}
<h1 class="mt-4">Document Reformatter</h1>
<div class="row">
    <div class="col-md-6">
        <form method="POST" enctype="multipart/form-data">
            <input type="hidden" name="action" value="select_client">
            <div class="form-group">
                <label for="client_id">Select Client:</label>
                <select class="form-control" id="client_id" name="client_id" onchange="this.form.submit()">
                    <option value="">Select a client</option>
                    {% for client in clients %}
                        <option value="{{ client }}" {% if client == selected_client %}selected{% endif %}>{{ client }}</option>
                    {% endfor %}
                </select>
            </div>
        </form>
        {% if selected_client %}
            <form method="POST" enctype="multipart/form-data">
                <input type="hidden" name="action" value="upload_document">
                <div class="form-group">
                    <label for="prompt_name">Select Prompt:</label>
                    <select class="form-control" id="prompt_name" name="prompt_name" onchange="loadPromptContent()">
                        <option value="">Select a prompt</option>
                        {% for prompt in prompts %}
                            <option value="{{ prompt.prompt_name }}" {% if prompt.prompt_name == selected_prompt %}selected{% endif %}>{{ prompt.prompt_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="document_file">Upload Document (.docx):</label>
                    <input type="file" class="form-control-file" id="document_file" name="document_file" accept=".docx" required>
                </div>
                <div class="form-group">
                    <label for="template_file">Upload Template (.docx):</label>
                    <input type="file" class="form-control-file" id="template_file" name="template_file" accept=".docx">
                </div>
                <button type="submit" class="btn btn-primary">Reformat Document</button>
            </form>
            <form method="POST" enctype="multipart/form-data" class="mt-3">
                <input type="hidden" name="action" value="upload_template">
                <div class="form-group">
                    <label for="prompt_name_template">Prompt for Template:</label>
                    <select class="form-control" id="prompt_name_template" name="prompt_name">
                        <option value="">Select a prompt</option>
                        {% for prompt in prompts %}
                            <option value="{{ prompt.prompt_name }}">{{ prompt.prompt_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="template_file_only">Upload Template Only (.docx):</label>
                    <input type="file" class="form-control-file" id="template_file_only" name="template_file" accept=".docx" required>
                </div>
                <button type="submit" class="btn btn-secondary">Upload Template</button>
            </form>
        {% endif %}
    </div>
    <div class="col-md-6">
        <h4>Prompt Content</h4>
        <div class="form-group">
            <label for="custom_prompt">Edit Prompt for This Conversion:</label>
            <textarea class="form-control" id="custom_prompt" name="custom_prompt" rows="10">{{ prompt_content }}</textarea>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
$(document).ready(function() {
    // Load prompt content on page load if a prompt is selected
    if ($('#prompt_name').val()) {
        loadPromptContent();
    }
});
</script>
{% endblock %}